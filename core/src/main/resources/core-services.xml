<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2009 Igor Azarnyi, Denys Pavlov
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/cache
	   http://www.springframework.org/schema/cache/spring-cache.xsd">

    <cache:annotation-driven />

    <import resource="cache-config.xml"/>

    <bean id="priceNavigation" class="org.yes.cart.domain.query.impl.PriceNavigationImpl"/>

    <bean id="hashHelper" class="org.yes.cart.service.domain.impl.MD5HashHelperImpl" scope="prototype"/>


    <bean id="luceneQueryFactory" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.domain.query.impl.LuceneQueryFactoryImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.query.PriceNavigation" ref="priceNavigation"/>
                <constructor-arg index="1" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
            </bean>
        </property>
    </bean>

    <bean id="systemService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.SystemServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="systemDao"/>
                <constructor-arg type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
            </bean>
        </property>
    </bean>


    <bean id="shopService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg type="org.yes.cart.service.domain.CategoryService" ref="categoryService"/>
                <constructor-arg type="org.yes.cart.service.domain.ContentService" ref="contentService"/>
                <constructor-arg type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
            </bean>
        </property>
    </bean>


    <bean id="shopUrlService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopUrlServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopUrlDao"/>
            </bean>
        </property>
    </bean>


    <bean id="shopExchangeRateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopExchangeRateServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopExchangeRateDao"/>
            </bean>
        </property>
    </bean>


    <bean id="categoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CategoryServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="categoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
            </bean>
        </property>
    </bean>

    <bean id="contentService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ContentServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="categoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
            </bean>
        </property>
    </bean>

    <bean id="prodTypeAttributeViewGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProdTypeAttributeViewGroupServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="prodTypeAttributeViewGroupDao"/>
            </bean>
        </property>
    </bean>

    <bean id="productService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
                <constructor-arg index="1" type="org.yes.cart.service.domain.ProductSkuService" ref="productSkuService"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="productTypeDao"/>
                <constructor-arg index="3" type="org.yes.cart.dao.GenericDAO" ref="productCategoryDao"/>
                <constructor-arg index="4" type="org.yes.cart.dao.GenericDAO" ref="productTypeAttrDao"/>
                <constructor-arg index="5" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
            </bean>
        </property>
    </bean>


    <bean id="productSkuService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductSkuServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productSkuDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="skuPriceDao"/>
            </bean>
        </property>
    </bean>

    <bean id="addressService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AddressServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="addressDao"/>
            </bean>
        </property>
    </bean>



    <bean id="customerWishListService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerWishListServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="customerWishListDao"/>
            </bean>
        </property>
    </bean>



    <bean id="attributeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AttributeServiceImpl">
                <constructor-arg index="0" ref="attributeDao"/>
                <constructor-arg index="1" ref="attributeGroupService"/>
                <constructor-arg index="2" value="true"/>
            </bean>
        </property>
    </bean>


    <!--     #############################   Image section begin   #############################    -->
    <bean id="categoryImageNameStrategy" class="org.yes.cart.service.image.impl.CategoryImageNameStrategyImpl"/>


    <bean id="productImageNameStrategy" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.image.impl.ProductImageNameStrategyImpl">
                <constructor-arg index="0" ref="attrValueEntityProductSkuDao"/>
                <constructor-arg index="1" ref="attrValueEntityProductDao"/>
            </bean>
        </property>
    </bean>

    <bean id="brandImageNameStrategy" class="org.yes.cart.service.image.impl.BrandImageNameStrategyImpl"/>

    <bean id="imageNameStrategyResolver" class="org.yes.cart.service.image.impl.ImageNameStrategyResolverImpl">
        <constructor-arg index="0" ref="brandImageNameStrategy"/>
        <constructor-arg index="1" ref="categoryImageNameStrategy"/>
        <constructor-arg index="2" ref="productImageNameStrategy"/>
    </bean>

    <!--
    Responsible:
        image resizing;
        storing images into repository during bulk import;
        work with brand, product, sku and category images.
    -->

    <bean id="imageService" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.domain.impl.ImageServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="seoImageDao"/>
                <constructor-arg type="org.yes.cart.service.image.ImageNameStrategyResolver" ref="imageNameStrategyResolver"/>
                <!--
                    Allowed pictures sizes to resize. Original image will be returned if requested size not allowed.
                -->
                <constructor-arg type="java.lang.String" value="40x40,50x50,60x60,80x80,200x200,160x160,360x360,120x120,280x280,240x240"/>
                <!--
                    Background RGB color for re-sized picture. When picture is scaled this is the border
                    color around the picture where it does not fill all the space
                -->
                <constructor-arg type="double" value="255"/>
                <constructor-arg type="double" value="255"/>
                <constructor-arg type="double" value="255"/>
                <!--
                    cropToFit setting this to true will crop the image to proper ratio prior to scaling
                    so that scaled image fills all the space. This is useful for those who wish to have
                    images that fill all space dedicated for image without having border around the image.
                    For those who wish images of products in the middle e.g. as it is in YC demo better
                    to set this to false.
                -->
                <constructor-arg type="boolean" value="false"/>
            </bean>
        </property>
    </bean>

    <!--     #############################   Image section end   #############################    -->

    <bean id="productAssociationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductAssociationServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="productAssociationDao"/>
            </bean>
        </property>
    </bean>

    <bean id="associationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AssociationServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="associationDao"/>
            </bean>
        </property>
    </bean>

    <bean id="priceService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.PriceServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.service.domain.ExchangeRateService" ref="exchangeRateService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.query.PriceNavigation" ref="priceNavigation"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="skuPriceDao"/>
                <constructor-arg index="3" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
            </bean>
        </property>
    </bean>


    <bean id="attributeGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AttributeGroupServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="attributeGroupDao"/>
            </bean>
        </property>
    </bean>


    <bean id="etypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.EtypeServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="etypeDao"/>
            </bean>
        </property>
    </bean>


    <bean id="exchangeRateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ExchangeRateServiceImpl"/>
        </property>
    </bean>


    <bean id="seoService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.SeoServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="seoDao"/>
            </bean>
        </property>
    </bean>


    <bean id="shopCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopCategoryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
            </bean>
        </property>
    </bean>





    <bean id="brandService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.BrandServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="brandDao"/>
            </bean>
        </property>
    </bean>

    <bean id="carrierService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CarrierServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="carrierDao"/>
            </bean>
        </property>
    </bean>

    <bean id="carrierSlaService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CarrierSlaServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="carrierSlaDao"/>
            </bean>
        </property>
    </bean>

    <bean id="shopTopSellerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopTopSellerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="shopTopSellerDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
            </bean>
        </property>
    </bean>


    <bean id="warehouseService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.WarehouseServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="warehouseDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="shopWarehouseDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productTypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductTypeServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productTypeDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productTypeAttrService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductTypeAttrServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productTypeAttrDao"/>
            </bean>
        </property>
    </bean>

    <bean id="countryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CountryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="countryDao"/>
            </bean>
        </property>
    </bean>

    <bean id="stateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.StateServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="stateDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductCategoryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productCategoryDao"/>
            </bean>
        </property>
    </bean>


    <bean id="customerOrderService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerOrderServiceImpl">
                <constructor-arg index="0"  ref="customerOrderDao"/>
                <constructor-arg index="1"  ref="customerDao"/>
                <constructor-arg index="2"  ref="genericDao"/>
                <constructor-arg index="3"  ref="customerOrderDeliveryDao"/>
                <constructor-arg index="4"  ref="orderAssembler"/>
                <constructor-arg index="5"  ref="deliveryAssembler"/>
                <constructor-arg index="6"  ref="customerOrderPaymentService"/>
            </bean>
        </property>
    </bean>

    <bean id="customerOrderDeliveryDetService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerOrderDeliveryDetServiceImpl">
                <constructor-arg index="0"  ref="customerOrderDeliveryDetDao"/>
            </bean>
        </property>
    </bean>

    <bean id="customerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="customerDao"/>
                <constructor-arg index="1" type="org.yes.cart.service.domain.HashHelper" ref="hashHelper"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="genericDao"/>
                <constructor-arg index="3" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
            </bean>
        </property>
    </bean>

    <bean id="managerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ManagerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="managerDao"/>
            </bean>
        </property>
    </bean>

    <bean id="skuWarehouseService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.SkuWarehouseServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="skuWarehouseDao"/>
                <property name="productService" ref="productService"/>
            </bean>
        </property>
    </bean>




    <!-- ############################################ DTO Support ######################################################################### -->


    <bean id="dtoAttributeGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoAttributeGroupServiceImpl">
                <constructor-arg index="0" ref="attributeGroupService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoAttributeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoAttributeServiceImpl">
                <constructor-arg index="0" ref="attributeService"/>
                <constructor-arg index="1" ref="etypeService"/>
                <constructor-arg index="2" ref="attributeGroupService"/>
                <constructor-arg index="3" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="4" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCategoryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="categoryService"/>
                <constructor-arg index="2" ref="shopCategoryService"/>
                <constructor-arg index="3" ref="productTypeService"/>
                <constructor-arg index="4" ref="dtoAttributeService"/>
                <constructor-arg index="5" ref="attrValueEntityCategoryDao"/>
                <constructor-arg index="6" ref="imageService"/>
                <constructor-arg index="7" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoContentService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoContentServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="contentService"/>
                <constructor-arg index="2" ref="productTypeService"/>
                <constructor-arg index="3" ref="dtoAttributeService"/>
                <constructor-arg index="4" ref="attrValueEntityCategoryDao"/>
                <constructor-arg index="5" ref="imageService"/>
                <constructor-arg index="6" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoEtypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoEtypeServiceImpl">
                <constructor-arg index="0" ref="etypeService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>



    <bean id="dtoProductService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProductServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="productService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="3" ref="seoService"/>
                <constructor-arg index="4" ref="dtoAttributeService"/>
                <constructor-arg index="5" ref="attrValueEntityProductDao"/>
                <constructor-arg index="6" ref="imageService"/>
                <constructor-arg index="7" ref="dtoProductTypeAttrService"/>
                <constructor-arg index="8" ref="dtoProductCategoryService"/>
                <constructor-arg index="9" ref="dtoProductSkuService"/>
                <constructor-arg index="10" ref="languageService"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoProductSkuService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProductSkuServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="productSkuService"/>
                <constructor-arg index="2" ref="dtoAttributeService"/>
                <constructor-arg index="3" ref="attrValueEntityProductSkuDao"/>
                <constructor-arg index="4" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="5" ref="priceService"/>
                <constructor-arg index="6" ref="seoService"/>
                <constructor-arg index="7" ref="imageService"/>
                <constructor-arg index="8" ref="productService"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoPriceListService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoPriceListsServiceImpl">
                <constructor-arg index="0" ref="dtoShopService"/>
                <constructor-arg index="1" ref="dtoProductSkuService"/>
                <constructor-arg index="2" ref="skuPriceDao"/>
                <constructor-arg index="3" ref="productSkuDao"/>
                <constructor-arg index="4" ref="shopDao"/>
                <constructor-arg index="5" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="6" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoShopService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoShopServiceImpl">
                <constructor-arg index="0" ref="shopService"/>
                <constructor-arg index="1" ref="customerService"/>
                <constructor-arg index="2" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="3" ref="dtoAttributeService"/>
                <constructor-arg index="4" ref="attrValueEntityShopDao"/>
                <constructor-arg index="5" ref="imageService"/>
                <constructor-arg index="6" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoSystemService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoSystemServiceImpl">
                <constructor-arg index="0" ref="systemService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="2" ref="dtoAttributeService"/>
                <constructor-arg index="3" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoShopUrlService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoShopUrlServiceImpl">
                <constructor-arg index="0" ref="shopUrlService"/>
                <constructor-arg index="1" ref="shopService"/>
                <constructor-arg index="2" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="3" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>


    <bean id="dtoShopExchangeRateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoShopExchangeRateServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="shopExchangeRateService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="3" ref="shopService"/>
                <constructor-arg index="4" ref="priceService"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoBrandService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoBrandServiceImpl">
                <constructor-arg index="0" ref="brandService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="2" ref="dtoAttributeService"/>
                <constructor-arg index="3" ref="attrValueEntityBrandDao"/>
                <constructor-arg index="4" ref="imageService"/>
                <constructor-arg index="5" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoWarehouseService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoWarehouseServiceImpl">
                <constructor-arg index="0" ref="warehouseService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="3" ref="skuWarehouseService"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoInventoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoInventoryServiceImpl">
                <constructor-arg index="0" ref="dtoWarehouseService"/>
                <constructor-arg index="1" ref="skuWarehouseDao"/>
                <constructor-arg index="2" ref="productSkuDao"/>
                <constructor-arg index="3" ref="warehouseDao"/>
                <constructor-arg index="4" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="5" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoProductTypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProductTypeServiceImpl">
                <constructor-arg index="0" ref="productTypeService"/>
                <constructor-arg index="1" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoProductTypeAttrService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProductTypeAttrServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="productTypeAttrService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoAssociationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoAssociationServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="associationService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoProductAssociationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProductAssociationServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="productAssociationService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoCustomerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCustomerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="customerService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="3" ref="dtoAttributeService"/>
                <constructor-arg index="4" ref="attrValueEntityCustomerDao"/>
                <constructor-arg index="5" ref="shopDao"/>
                <constructor-arg index="6" ref="passPhraseGenerator"/>
            </bean>
        </property>
    </bean>


    <bean id="dtoAddressService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoAddressServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="addressService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>



    <bean id="dtoCarrierService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCarrierServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="carrierService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoCarrierSlaService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCarrierSlaServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="carrierSlaService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoProdTypeAttributeViewGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProdTypeAttributeViewGroupServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="prodTypeAttributeViewGroupService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="3" ref="productTypeService"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoCustomerOrderService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCustomerOrderServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="customerOrderService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="3" ref="orderStateManager"/>
                <constructor-arg index="4" ref="paymentModulesManager"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoCustomerOrderDeliveryDetailService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCustomerOrderDeliveryDetailServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="customerOrderDeliveryDetService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>


    <bean id="dtoCustomerWishListService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCustomerWishListServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="customerWishListService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>


    <bean id="dtoImageService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoImageServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="imageService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoProductCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoProductCategoryServiceImpl">
                <constructor-arg index="0" ref="productCategoryService"/>
                <constructor-arg index="1" ref="productService"/>
                <constructor-arg index="2" ref="categoryService"/>
                <constructor-arg index="3" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="4" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>


    <bean id="userManagementService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.ManagementServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.service.domain.ManagerService" ref="managerService"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="managerRoleDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="roleDao"/>
                <constructor-arg index="3" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="4" ref="dtoAssemblerAdaptersRepository"/>
                <constructor-arg index="5" ref="passPhraseGenerator"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoCountryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoCountryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="countryService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>

    <bean id="dtoStateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.dto.impl.DtoStateServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.domain.dto.factory.DtoFactory" ref="dtoInterfaceToClassFactory"/>
                <constructor-arg index="1" ref="stateService"/>
                <constructor-arg index="2" ref="dtoAssemblerAdaptersRepository"/>
            </bean>
        </property>
    </bean>


    <bean id="dtoInterfaceToClassFactory" class="org.yes.cart.domain.dto.factory.impl.DtoFactoryImpl">
        <constructor-arg>
            <map>
                <entry key="org.yes.cart.domain.dto.ProdTypeAttributeViewGroupDTO" value="org.yes.cart.domain.dto.impl.ProdTypeAttributeViewGroupDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductSkuDTO" value="org.yes.cart.domain.dto.impl.ProductSkuDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.SkuPriceDTO" value="org.yes.cart.domain.dto.impl.SkuPriceDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.PriceListDTO" value="org.yes.cart.domain.dto.impl.PriceListDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ManagerDTO" value="org.yes.cart.domain.dto.impl.ManagerDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.RoleDTO" value="org.yes.cart.domain.dto.impl.RoleDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttributeGroupDTO" value="org.yes.cart.domain.dto.impl.AttributeGroupDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttributeDTO" value="org.yes.cart.domain.dto.impl.AttributeDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.EtypeDTO" value="org.yes.cart.domain.dto.impl.EtypeDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ShopDTO" value="org.yes.cart.domain.dto.impl.ShopDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ShopUrlDTO" value="org.yes.cart.domain.dto.impl.ShopUrlDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ShopExchangeRateDTO" value="org.yes.cart.domain.dto.impl.ShopExchangeRateDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CategoryDTO" value="org.yes.cart.domain.dto.impl.CategoryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.BrandDTO" value="org.yes.cart.domain.dto.impl.BrandDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductTypeDTO" value="org.yes.cart.domain.dto.impl.ProductTypeDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductTypeAttrDTO" value="org.yes.cart.domain.dto.impl.ProductTypeAttrDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductCategoryDTO" value="org.yes.cart.domain.dto.impl.ProductCategoryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductDTO" value="org.yes.cart.domain.dto.impl.ProductDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductSearchResultDTO" value="org.yes.cart.domain.dto.impl.ProductSearchResultDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductSkuDTO" value="org.yes.cart.domain.dto.impl.ProductSkuDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueCategoryDTO" value="org.yes.cart.domain.dto.impl.AttrValueCategoryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueCustomerDTO" value="org.yes.cart.domain.dto.impl.AttrValueCustomerDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CustomerDTO" value="org.yes.cart.domain.dto.impl.CustomerDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CustomerCardDTO" value="org.yes.cart.domain.dto.impl.CustomerCardDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CustomerWishListDTO" value="org.yes.cart.domain.dto.impl.CustomerWishListDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueProductDTO" value="org.yes.cart.domain.dto.impl.AttrValueProductDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueProductSkuDTO"
                       value="org.yes.cart.domain.dto.impl.AttrValueProductSkuDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueBrandDTO" value="org.yes.cart.domain.dto.impl.AttrValueBrandDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueShopDTO" value="org.yes.cart.domain.dto.impl.AttrValueShopDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.AttrValueSystemDTO" value="org.yes.cart.domain.dto.impl.AttrValueSystemDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.WarehouseDTO" value="org.yes.cart.domain.dto.impl.WarehouseDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ShopWarehouseDTO" value="org.yes.cart.domain.dto.impl.ShopWarehouseDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ShopCategoryDTO" value="org.yes.cart.domain.dto.impl.ShopCategoryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.SkuWarehouseDTO" value="org.yes.cart.domain.dto.impl.SkuWarehouseDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.InventoryDTO" value="org.yes.cart.domain.dto.impl.InventoryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.SeoImageDTO" value="org.yes.cart.domain.dto.impl.SeoImageDTOImpl"/>

                <entry key="org.yes.cart.domain.dto.AssociationDTO" value="org.yes.cart.domain.dto.impl.AssociationDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.ProductAssociationDTO"  value="org.yes.cart.domain.dto.impl.ProductAssociationDTOImpl"/>
                
                <entry key="org.yes.cart.domain.dto.AddressDTO"  value="org.yes.cart.domain.dto.impl.AddressDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CarrierDTO"  value="org.yes.cart.domain.dto.impl.CarrierDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CarrierSlaDTO"  value="org.yes.cart.domain.dto.impl.CarrierSlaDTOImpl"/>

                <entry key="org.yes.cart.domain.dto.CountryDTO"  value="org.yes.cart.domain.dto.impl.CountryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.StateDTO"  value="org.yes.cart.domain.dto.impl.StateDTOImpl"/>


                <entry key="org.yes.cart.domain.dto.CustomerOrderDTO"  value="org.yes.cart.domain.dto.impl.CustomerOrderDTOImpl"/>

                <entry key="org.yes.cart.domain.entity.Seo"  value="org.yes.cart.domain.entity.impl.SeoEntity"/>

                <entry key="org.yes.cart.domain.dto.CustomerOrderDeliveryDetailDTO"  value="org.yes.cart.domain.dto.impl.CustomerOrderDeliveryDetailDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CustomerOrderDeliveryDTO"        value="org.yes.cart.domain.dto.impl.CustomerOrderDeliveryDTOImpl"/>
                <entry key="org.yes.cart.domain.dto.CustomerOrderDeliveryDetailDTO"        value="org.yes.cart.domain.dto.impl.CustomerOrderDeliveryDetailDTOImpl"/>

            </map>
        </constructor-arg>
    </bean>

    <!-- ######################### Dto to entity convertors and repository    ############################### -->
    <bean id="brandDTO2Brand" class="org.yes.cart.domain.dto.adapter.impl.GenericDtoToEntityConverter">
        <constructor-arg index="0" ref="brandDao"/>
    </bean>


    <bean id="productTypeDTO2ProductType" class="org.yes.cart.domain.dto.adapter.impl.GenericDtoToEntityConverter">
        <constructor-arg index="0" ref="productTypeDao"/>
    </bean>

    <bean id="associationDTO2Association" class="org.yes.cart.domain.dto.adapter.impl.AssociationIdToEntityConverter">
        <constructor-arg index="0" ref="associationDao"/>
    </bean>

    <bean id="productId2Product" class="org.yes.cart.domain.dto.adapter.impl.ProductIdToEntityConverter">
        <constructor-arg index="0" ref="productDao"/>
    </bean>

    <bean id="skuId2Sku" class="org.yes.cart.domain.dto.adapter.impl.ProductSkuIdToEntityConverter">
        <constructor-arg index="0" ref="productSkuDao"/>
    </bean>

    <bean id="shopId2Shop" class="org.yes.cart.domain.dto.adapter.impl.ShopIdToEntityConverter">
        <constructor-arg index="0" ref="shopDao"/>
    </bean>

    <bean id="warehouseId2Warehouse" class="org.yes.cart.domain.dto.adapter.impl.WarehouseIdToEntityConverter">
        <constructor-arg index="0" ref="warehouseDao"/>
    </bean>

    <bean id="carrierId2Carrier" class="org.yes.cart.domain.dto.adapter.impl.CarrierIdToEntityConverter">
        <constructor-arg index="0" ref="carrierDao"/>
    </bean>

    <bean id="producttypeId2ProductType" class="org.yes.cart.domain.dto.adapter.impl.ProductTypeIdToEntityConverter">
        <constructor-arg index="0" ref="productTypeDao"/>
    </bean>

    <bean id="attributeDTO2Attribute" class="org.yes.cart.domain.dto.adapter.impl.GenericDtoToEntityConverter">
        <constructor-arg index="0" ref="attributeDao"/>
    </bean>

    <bean id="bigDecimalToFloat" class="org.yes.cart.domain.dto.adapter.impl.BigDecimalToFloatValueConverter"/>

    <bean id="i18nStringConverter" class="org.yes.cart.domain.dto.adapter.impl.I18NStringConverter"/>

    <bean id="dtoAssemblerAdaptersRepository"
          class="com.inspiresoftware.lib.dto.geda.adapter.repository.impl.AdaptersRepositoryImpl">
        <constructor-arg>
            <map>
                <entry key="bigDecimalToFloat" value-ref="bigDecimalToFloat"/>
                <entry key="brandDTO2Brand" value-ref="brandDTO2Brand"/>
                <entry key="productTypeDTO2ProductType" value-ref="productTypeDTO2ProductType"/>
                <entry key="productId2Product" value-ref="productId2Product"/>
                <entry key="skuId2Sku" value-ref="skuId2Sku"/>
                <entry key="shopId2Shop" value-ref="shopId2Shop"/>
                <entry key="warehouseId2Warehouse" value-ref="warehouseId2Warehouse"/>
                <entry key="carrierId2Carrier" value-ref="carrierId2Carrier"/>
                <entry key="associationDTO2Association" value-ref="associationDTO2Association"/>
                <entry key="producttypeId2ProductType" value-ref="producttypeId2ProductType"/>

                <entry key="attributeDTO2Attribute" value-ref="attributeDTO2Attribute"/>

                <entry key="i18nStringConverter" value-ref="i18nStringConverter"/>

            </map>
        </constructor-arg>
    </bean>





    <!-- ########################################### ExtendedConversionService ################################# -->
    <bean id="extendedConversionService" class="org.yes.cart.utils.impl.ExtendedConversionService"/>


    <bean id="mailComposer" class="org.yes.cart.service.mail.impl.MailComposerImpl">
        <constructor-arg index="0" ref="systemService"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

<!-- ############################# Shopping Cart Commands and Events ######################### -->



    <bean id="shoppingCartCommandFactory" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandFactoryImpl">
        <constructor-arg index="0">
            <map>
                <entry key="addToCartCmd" value="org.yes.cart.shoppingcart.impl.AddSkuToCartEventCommandImpl"/>
                <entry key="addQuantityToCartCmd" value="org.yes.cart.shoppingcart.impl.SetSkuQuantityToCartEventCommandImpl"/>
                <entry key="removeAllSkuCmd" value="org.yes.cart.shoppingcart.impl.RemoveAllSkuFromCartCommandImpl"/>
                <entry key="removeOneSkuCmd" value="org.yes.cart.shoppingcart.impl.RemoveSkuFromCartCommandImpl"/>

                <entry key="changeCurrencyCmd" value="org.yes.cart.shoppingcart.impl.ChangeCurrencyEventCommandImpl"/>
                <entry key="changeLocaleCmd" value="org.yes.cart.shoppingcart.impl.ChangeLocaleCartCommandImpl"/>
                <entry key="logoutCmd" value="org.yes.cart.shoppingcart.impl.LogoutCommandImpl"/>
                <entry key="loginCmd" value="org.yes.cart.shoppingcart.impl.LoginCommandImpl"/>
                <entry key="expireCartCmd" value="org.yes.cart.shoppingcart.impl.ExpireCartCommandImpl"/>
                <entry key="setCarrierSlaCmd" value="org.yes.cart.shoppingcart.impl.SetCarrierSlaCartCommandImpl"/>
                <entry key="setBillingAddressSeparateCmd" value="org.yes.cart.shoppingcart.impl.SetBillingSeparateFromShippingAddressCommandImpl"/>
                <entry key="setMultipleDeliveryCmd" value="org.yes.cart.shoppingcart.impl.SetMultipleDeliveryCommandImpl"/>

                <entry key="cleanCartCmd" value="org.yes.cart.shoppingcart.impl.CleanCartCommandImpl"/>

                <entry key="setShopIdCmd" value="org.yes.cart.shoppingcart.impl.SetShopCartCommandImpl"/>
                <entry key="setQuantityToCartCmd" value="org.yes.cart.shoppingcart.impl.SetSkuQuantityToCartEventCommandImpl"/>
            </map>
        </constructor-arg>
    </bean>

    <bean id="orderNumberGenerator" class="org.yes.cart.service.order.impl.DefaultOrderNumberGeneratorImpl">
        <constructor-arg index="0" ref="customerOrderDao"/>
    </bean>

    <bean id="orderAssembler" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.order.impl.OrderAssemblerImpl">
                <constructor-arg index="0" ref="orderNumberGenerator"/>
                <constructor-arg index="1" ref="customerDao"/>
                <constructor-arg index="2" ref="shopDao"/>
                <constructor-arg index="3" ref="productSkuDao"/>
                <constructor-arg index="4" value="{0} {1} {2} {3} {4} {5} {6} {7} {8}"/>
                <!-- Address format
                0 - address line 1
                1 - address line 2
                2 - post(zip) code
                3 - city
                4 - country code
                5 - county/state/provicne/area code
                6 - first name
                7 - last name
                8 - contact phone(s) as string
                -->
            </bean>
        </property>
    </bean>



    <bean id="deliveryAssembler" class="org.yes.cart.service.order.impl.DeliveryAssemblerImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="skuWarehouseService"/>        
        <constructor-arg index="2" ref="carrierSlaService"/>
    </bean>


    <!-- ################################## service locator ################################# -->

    <bean id="springInstantiationService" class="org.yes.cart.service.locator.impl.SpringInstantiationStrategyImpl"/>
    <bean id="webInstantiationService" class="org.yes.cart.service.locator.impl.WebServiceInstantiationStrategyImpl"/>
    <bean id="jnpInstantiationService" class="org.yes.cart.service.locator.impl.JnpInstantiationStrategyImpl"/>

    <bean id="serviceLocator" class="org.yes.cart.service.locator.impl.ServiceLocatorImpl">
        <constructor-arg index="0">
            <map>
                <entry key="http" value-ref="webInstantiationService"/>
                <entry key="https" value-ref="webInstantiationService"/>
                <entry key="jnp" value-ref="jnpInstantiationService"/>
                <entry>
                    <key><null/></key>
                    <ref bean="springInstantiationService"/>
                </entry>
            </map>
        </constructor-arg>

    </bean>

<!-- ################################# payment modules manager guess shall be  ########################################## -->

    <bean id="paymentModulesManager" class="org.yes.cart.service.payment.impl.PaymentModulesManagerImpl">
        <constructor-arg index="0" ref="serviceLocator"/>
        <constructor-arg index="1" ref="systemService"/>
    </bean>

    <bean id="paymentProcessor" parent="txProxyTemplate" scope="prototype">
        <property name="target">
            <bean class="org.yes.cart.service.payment.impl.PaymentProcessorImpl">
                <constructor-arg index="0" ref="customerOrderPaymentService"/>
            </bean>
        </property>
    </bean>
    

    <bean id="paymentProcessorFactory" class="org.yes.cart.service.payment.impl.PaymentProcessorFactoryImpl">
        <constructor-arg index="0" ref="paymentModulesManager"/>
        <constructor-arg index="1" value="paymentProcessor"/>
    </bean>


    <bean id="paymentProcessFacade" class="org.yes.cart.service.payment.impl.PaymentProcessFacadeImpl">
        <constructor-arg index="0" ref="customerOrderService"/>
        <constructor-arg index="1" ref="orderStateManager"/>
    </bean>


    <bean id="paymentCallBackHandlerFacade" class="org.yes.cart.service.payment.impl.PaymentCallBackHandlerFacadeImpl">
        <constructor-arg index="0" ref="paymentModulesManager"/>
        <constructor-arg index="1" ref="customerOrderService"/>
        <constructor-arg index="2" ref="orderStateManager"/>

    </bean>

<!-- ################################# order flow state manager  ########################################## -->

    <bean id="txProxyOrderEventHandlerTemplate" abstract="true"
          class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
        <property name="transactionManager" ref="transactionManager"/>
        <property name="transactionAttributes">
            <props>
                <prop key="handle">PROPAGATION_REQUIRED,-Throwable</prop>
            </props>
        </property>
    </bean>

    <!--
        Transition from none state to pending. Pending state is temporal and not persisted. Possible transition cancel or payment ok.
        Perform online payment authorization
    -->
    <bean id="pendingOrderEventHandler"  parent="txProxyOrderEventHandlerTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.handler.PendingOrderEventHandlerImpl">
                <constructor-arg index="0" ref="paymentProcessorFactory"/>
                <constructor-arg index="1" ref="warehouseService"/>
                <constructor-arg index="2" ref="skuWarehouseService"/>
            </bean>
        </property>
    </bean>

    <!--Wait for order confirmation in case of courier payment gateway or fund capture in case of offline bank payment gateway-->
    <bean id="paymentOfflineOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.PaymentOfflineOrderEventHandlerImpl"/>


    <!--Pefrom separate processing of order deliveries-->
    <bean id="paymentOkOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.PaymentOkOrderEventHandlerImpl"/>


    <!-- Process quantity allocation on warehouses -->
    <bean id="processAllocationOrderEventHandler"  parent="txProxyOrderEventHandlerTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.handler.ProcessAllocationOrderEventHandlerImpl">
                <constructor-arg index="0" ref="warehouseService"/>
                <constructor-arg index="1" ref="skuWarehouseService"/>
            </bean>
        </property>
    </bean>

    <!--Order , that wait confirmation approved-->
    <bean id="paymentConfirmedOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.PaymentConfirmedOrderEventHandlerImpl" />

    <!--Cancel order-->
    <bean id="cancelOrderEventHandler"  parent="txProxyOrderEventHandlerTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.handler.CancelOrderEventHandlerImpl">
                <constructor-arg index="0" ref="warehouseService"/>
                <constructor-arg index="1" ref="skuWarehouseService"/>
            </bean>
        </property>
    </bean>

    <!-- Simple transition to time wait state, because of mixed delivery of pre order -->
    <bean id="processTimeWaitOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.ProcessTimeWaitOrderEventHandlerImpl"/>

    <!-- Simple transition to inventory wait state, because of back order -->
    <bean id="processInventoryWaitOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.ProcessInventoryWaitOrderEventHandlerImpl"/>

    <!-- Transition from time wait to inventory wait state -->
    <bean id="deliveryAllowedByTimeoutOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.DeliveryAllowedByTimeoutOrderEventHandlerImpl"/>

    <!-- Transition from inventory wait state to inventory allocation -->
    <bean id="deliveryAllowedByInventoryOrderEventHandler"  parent="txProxyOrderEventHandlerTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.handler.DeliveryAllowedByInventoryOrderEventHandlerImpl">
                <constructor-arg index="0" ref="warehouseService"/>
                <constructor-arg index="1" ref="skuWarehouseService"/>
            </bean>
        </property>
    </bean>


    <!-- Simple transition delivery released to packing -->
    <bean id="releaseToPackOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.ReleaseToPackOrderEventHandlerImpl"/>

    <!-- Pack completed . Wait for shipment -->
    <bean id="packCompleteOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.PackCompleteOrderEventHandlerImpl"/>

    <!-- Shipment in progress -->
    <bean id="releaseToShipmentOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.ReleaseToShipmentOrderEventHandlerImpl"/>

    <!-- Shipment completed -->
    <bean id="shipmentCompleteOrderEventHandler"
          class="org.yes.cart.service.order.impl.handler.ShipmentCompleteOrderEventHandlerImpl">
        <constructor-arg index="0" ref="paymentProcessorFactory"/>
    </bean>

    <!-- Cancel with refund -->
    <bean id="cancelOrderWithRefundOrderEventHandler"  parent="txProxyOrderEventHandlerTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.handler.CancelOrderWithRefundOrderEventHandlerImpl">
                <constructor-arg index="0" ref="paymentProcessorFactory"/>
                <constructor-arg index="1" ref="warehouseService"/>
                <constructor-arg index="2" ref="skuWarehouseService"/>
            </bean>
        </property>
    </bean>



    <bean id="orderStateManager" class="org.yes.cart.service.order.impl.OrderStateManagerImpl">
        <constructor-arg index="0">
            <map>
                <entry key="evt.pending"                   value-ref="pendingOrderEventHandler"/>
                <entry key="evt.payment.offline"           value-ref="paymentOfflineOrderEventHandler"/>
                <entry key="evt.payment.confirmed"         value-ref="paymentConfirmedOrderEventHandler"/>
                <entry key="evt.payment.ok"                value-ref="paymentOkOrderEventHandler"/>
                <entry key="evt.process.allocation"        value-ref="processAllocationOrderEventHandler"/>
                <entry key="evt.order.cancel"              value-ref="cancelOrderEventHandler"/>
                <entry key="evt.process.date.wait"         value-ref="processTimeWaitOrderEventHandler"/>
                <entry key="evt.process.inventory.wait"    value-ref="processInventoryWaitOrderEventHandler"/>
                <entry key="evt.delivery.allowed.timeout"  value-ref="deliveryAllowedByTimeoutOrderEventHandler"/>
                <entry key="evt.delivery.allowed.quantity" value-ref="deliveryAllowedByInventoryOrderEventHandler"/>
                <entry key="evt.release.to.pack"           value-ref="releaseToPackOrderEventHandler"/>
                <entry key="evt.packing.complete"          value-ref="packCompleteOrderEventHandler"/>
                <entry key="evt.release.to.shipment"       value-ref="releaseToShipmentOrderEventHandler"/>
                <entry key="evt.shipment.complete"         value-ref="shipmentCompleteOrderEventHandler"/>
                <entry key="evt.order.cancel.refund"       value-ref="cancelOrderWithRefundOrderEventHandler"/>
            </map>
        </constructor-arg>
        <constructor-arg index="1">
            <map/>
        </constructor-arg>
        <constructor-arg index="2">
            <map/>
        </constructor-arg>
    </bean>

    <!-- ############################################ misc ####################################### -->

    <bean id="pluralFormService" class="org.yes.cart.service.misc.impl.PluralFormServiceImpl"/>

    <bean id="passPhraseGenerator" class="org.yes.cart.service.domain.impl.PassPhraseGeneratorImpl">
        <constructor-arg index="0" value="8"/>
    </bean>

    <bean id="passwordHashHelper" class="org.yes.cart.service.domain.impl.MD5HashHelperImpl"/>

    <!--TODOv2  must read languages from db-->
    <bean id="languageService" class="org.yes.cart.service.misc.impl.LanguageServiceImpl">
        <constructor-arg index="0">
            <map>
                <entry key="en" value="English"/>
                <entry key="ru" value="&#x0420;&#x0443;&#x0441;&#x0441;&#x043a;&#x0438;&#x0439;"/>
            </map>
        </constructor-arg>
        <constructor-arg index="1">
            <map>
                <entry key="DEFAULT">
                    <list>
                        <!-- by convention the 0th element is the default language -->
                        <value>en</value>
                        <value>ru</value>
                    </list>
                </entry>
                <entry key="SHOP10">
                    <list>
                        <!-- by convention the 0th element is the default language -->
                        <value>en</value>
                        <value>ru</value>
                    </list>
                </entry>
            </map>
        </constructor-arg>
    </bean>


    <!-- ########################################## bulk import ########################## -->

    <bean id="importDescriptorXStreamProvider" class="org.yes.cart.bulkimport.stream.xml.CsvImportDescriptorXStreamProvider"/>

    <bean id="csvBulkImportService" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.bulkimport.csv.impl.CsvBulkImportServiceImpl" scope="prototype">
                <property name="genericDAO" ref="genericDao"/>
                <property name="extendedConversionService" ref="extendedConversionService"/>
                <property name="importDescriptorXStreamProvider" ref="importDescriptorXStreamProvider"/>
            </bean>
        </property>
    </bean>

    <bean id="bulkImportImageService" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.bulkimport.image.impl.BulkImportImagesServiceImpl" scope="prototype">
                <constructor-arg index="0" ref="genericDao"/>
                <constructor-arg index="1" ref="attributeService"/>
                <constructor-arg index="2" ref="imageService"/>
                <constructor-arg index="3" value="_([.[^_]]*)_[a-z]\.jpe?g$"/>
                <constructor-arg index="4" value="(.*)\.jpe?g"/>
            </bean>
        </property>
    </bean>




</beans>