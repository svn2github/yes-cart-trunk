<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:controls="controls.*"
           width="100%"
           height="100%"
           creationComplete="init();">

    <mx:Script>
		<![CDATA[
        import com.hexagonstar.util.debug.Debug;

        import org.yes.cart.shopmanager.ShopManagerGlobal;

        import mx.rpc.events.FaultEvent;
        import mx.rpc.events.ResultEvent;

        public function init():void {
            importBtn.enabled = true;
            Debug.trace("INFO current state is readyToImportState init");
        }


        /**
         * Start import.
         * @param event event.
         * @return nothing
         */
        protected function importClickHandler(event:MouseEvent):void {

            importBtn.enabled = false;
            resultReady = false;
            reindexInProcess = true;
            bulkImportService.doImport();
            Debug.trace("INFO current state is inProgressState");
        }

        protected function reindexService_resultHandler(event:ResultEvent):void {
            Debug.trace("INFO Bulk import result is " + bulkImportService.doImport.lastResult);
            importBtn.enabled = true;
            resultText.text = resourceManager.getString("BulkImportPanel", "importResult");
            resultDetails.text = bulkImportService.doImport.lastResult;
            resultReady = true;
            reindexInProcess = false;
            Debug.trace("INFO current state is readyToImport");

        }


        protected function reindexService_faultHandler(event:FaultEvent):void {
            Debug.trace("FAULT Bulk import fault");
            Debug.traceObj(event);
            resultText.text = resourceManager.getString("BulkImportPanel", "importFailed");
            resultDetails.text = event.toString();
            importBtn.enabled = true;
            resultReady = true;
            reindexInProcess = false;
            Debug.trace("INFO current state is readyToImport");

        }
        ]]>
	</mx:Script>


    <mx:RemoteObject showBusyCursor="true" id="bulkImportService"
                     destination="bulkImportService"
                     result="reindexService_resultHandler(event)"
                     fault="reindexService_faultHandler(event)"
                     channelSet="{ShopManagerGlobal.instance.channelSet}"/>

    <mx:Boolean id="resultReady">false</mx:Boolean>
    <mx:Boolean id="reindexInProcess">false</mx:Boolean>


    <mx:Canvas id="reindexPanel" x="0" y="0" height="100%" width="100%">
        <mx:VBox width="100%" height="100%">

            <mx:Label text="@Resource(bundle='BulkImportPanel',key='importMessage')"/>

            <mx:HBox height="64" width="100%">
                <mx:Label text="@Resource(bundle='BulkImportPanel',key='startMessage')"/>
                <mx:Button id="importBtn" label="@Resource(bundle='BulkImportPanel',key='start')"
                           click="importClickHandler(event)"/>
            </mx:HBox>

            <mx:Label id="resultText" includeInLayout="{resultReady}" visible="{resultReady}"/>
            <mx:Label id="reintexingText" text="@Resource(bundle='BulkImportPanel',key='importInProcess')"
                      includeInLayout="{reindexInProcess}" visible="{reindexInProcess}"/>
            <mx:TextArea id="resultDetails" includeInLayout="{resultReady}" visible="{resultReady}" width="100%"
                         height="100%"/>
        </mx:VBox>
    </mx:Canvas>


</mx:Canvas>
