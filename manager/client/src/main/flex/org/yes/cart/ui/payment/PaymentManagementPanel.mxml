<?xml version="1.0" ?>
<!--
  - Copyright 2009 Igor Azarnyi, Denys Pavlov
  -
  -    Licensed under the Apache License, Version 2.0 (the "License");
  -    you may not use this file except in compliance with the License.
  -    You may obtain a copy of the License at
  -
  -        http://www.apache.org/licenses/LICENSE-2.0
  -
  -    Unless required by applicable law or agreed to in writing, software
  -    distributed under the License is distributed on an "AS IS" BASIS,
  -    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  -    See the License for the specific language governing permissions and
  -    limitations under the License.
  -->

<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
           xmlns:georg="com.georg.*" width="100%" height="100%"
           creationComplete="init();">


    <mx:Script><![CDATA[
        import mx.rpc.AsyncResponder;
        import mx.rpc.events.ResultEvent;

        import org.yes.cart.shopmanager.ShopManagerGlobal;

        private function init():void {

            localeFilter = resourceManager.getString('ReportPanel', 'localeFilter');       //todo move to one place


            remotePaymentModulesManagementService.getAvailablePaymentGateways(localeFilter).addResponder(
                    new AsyncResponder(
                            function (event:ResultEvent, obj:Object = null):void {
                                paymentGateway.dataProvider = event.result;
                            }
                            ,
                            ShopManagerGlobal.instance.defaultOnRpcMethodFault)
            );

        }



        /**
         * Perform customer search.
         * @param event event
         * @return nothing
         */
        private function onApplyFilterClick(event:MouseEvent):void {

            remotePaymentModulesManagementService.findPayments(
                    orderNumber.text==""?null:orderNumber.text,
                    fromDate.selectedDate,
                    tillDate.selectedDate,
                    cardHolderName.text==""?null:cardHolderName.text,
                    lastCardDigits.text==""?null:lastCardDigits.text,
                    paymentGateway.selectedIndex==-1?null:paymentGateway.text
            );

        }

        /**
         * Clear search criteria.
         * @param event event
         * @return nothing
         */
        private function onCleanFilterClick(event:MouseEvent):void {


            fromDate.selectedDate = null;
            tillDate.selectedDate = null;
            orderNumber.text = "";
            lastCardDigits.text = "";
            cardHolderName.text = "";
            paymentGateway.selectedIndex = -1;


        }

        private function paymentToolTip(item:Object):String {
            var toolTip:String = "";
            return toolTip;
        }
        ]]>

    </mx:Script>

    <mx:RemoteObject showBusyCursor="true" id="remotePaymentModulesManagementService"
                     destination="remotePaymentModulesManagementService"
                     channelSet="{ShopManagerGlobal.instance.channelSet}"/>

    <mx:String id="localeFilter"/>

    <mx:VBox width="100%" height="100%">
        <mx:Panel width="100%" height="100%" title="@Resource(bundle='PaymentManagementPanel',key='payments')">
            <mx:ControlBar>
                <mx:VBox width="100%">

                    <mx:Grid>
                        <mx:GridRow>
                            <mx:GridItem>
                                <mx:Label text="@Resource(bundle='PaymentManagementPanel',key='orderNumber')"/>
                                <mx:TextInput id="orderNumber" width="150"/>
                            </mx:GridItem>
                            <mx:GridItem>
                                <mx:Label text="@Resource(bundle='PaymentManagementPanel',key='fromDate')"/>
                                <georg:DateTimeField id="fromDate" width="130"/>
                            </mx:GridItem>
                            <mx:GridItem>
                                <mx:Label text="@Resource(bundle='PaymentManagementPanel',key='tillDate')"/>
                                <georg:DateTimeField id="tillDate" width="130"/>
                            </mx:GridItem>
                        </mx:GridRow>
                        <mx:GridRow>
                            <mx:GridItem>
                                <mx:Label text="@Resource(bundle='PaymentManagementPanel',key='cardHolderName')"/>
                                <mx:TextInput id="cardHolderName" width="150"/>
                            </mx:GridItem>
                            <mx:GridItem>
                                <mx:Label text="@Resource(bundle='PaymentManagementPanel',key='lastCardDigits')"/>
                                <mx:TextInput id="lastCardDigits" width="150"/>
                            </mx:GridItem>
                            <mx:GridItem>
                                <mx:Label text="@Resource(bundle='PaymentManagementPanel',key='paymentGateway')"/>
                                <mx:ComboBox id="paymentGateway" width="150" dataProvider=""/>
                            </mx:GridItem>
                        </mx:GridRow>
                    </mx:Grid>
                </mx:VBox>

                <mx:Button height="100%" label="@Resource(bundle='PaymentManagementPanel',key='applyFilter')"
                           toolTip="@Resource(bundle='PaymentManagementPanel',key='applyFilterToolTip')"
                           click="onApplyFilterClick(event)"
                        />
                <mx:Button height="100%" label="@Resource(bundle='PaymentManagementPanel',key='clearFilter')"
                           toolTip="@Resource(bundle='PaymentManagementPanel',key='clearFilterToolTip')"
                           click="onCleanFilterClick(event)"
                        />

            </mx:ControlBar>

            <mx:DataGrid x="0" y="0" width="100%" height="99%"
                         dataTipFunction="paymentToolTip"
                         dataProvider="{remotePaymentModulesManagementService.findPayments.lastResult}">

                <mx:columns>
                    <mx:DataGridColumn showDataTips="true" width="50"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='customerOrderPaymentId')"
                                       dataField="customerOrderPaymentId"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='cardHolderName')"
                                       dataField="cardHolderName"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='orderDate')"
                                       dataField="orderDate"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='paymentAmount')"
                                       dataField="paymentAmount"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='orderCurrency')"
                                       dataField="orderCurrency"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='orderNumber')"
                                       dataField="orderNumber"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='orderShipment')"
                                       dataField="orderShipment"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='transactionOperation')"
                                       dataField="transactionOperation"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='transactionOperationResultCode')"
                                       dataField="transactionOperationResultCode"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='paymentProcessorResult')"
                                       dataField="paymentProcessorResult"/>

                    <mx:DataGridColumn showDataTips="true"
                                       headerText="@Resource(bundle='PaymentManagementPanel',key='transactionGatewayLabel')"
                                       dataField="transactionGatewayLabel"/>

                </mx:columns>

            </mx:DataGrid>
        </mx:Panel>
    </mx:VBox>


</mx:Canvas>
