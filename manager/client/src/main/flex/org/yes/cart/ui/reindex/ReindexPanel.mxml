<?xml version="1.0" encoding="utf-8"?>
<!--
  - Copyright 2009 Igor Azarnyi, Denys Pavlov
  -
  -    Licensed under the Apache License, Version 2.0 (the "License");
  -    you may not use this file except in compliance with the License.
  -    You may obtain a copy of the License at
  -
  -        http://www.apache.org/licenses/LICENSE-2.0
  -
  -    Unless required by applicable law or agreed to in writing, software
  -    distributed under the License is distributed on an "AS IS" BASIS,
  -    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  -    See the License for the specific language governing permissions and
  -    limitations under the License.
  -->

<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
           width="100%"
           height="100%"
           creationComplete="init();">

	<mx:Script>
		<![CDATA[
        import org.yes.cart.shopmanager.ShopManagerGlobal;

        import mx.controls.Alert;

        import mx.rpc.AsyncResponder;
        import mx.rpc.AsyncToken;
        import mx.rpc.events.FaultEvent;
        import mx.rpc.events.ResultEvent;

        public function init():void {

        }


        protected function onReindexBtnClick(event:MouseEvent):void {

            reindexBtn.enabled = false;
            resultReady = false;
            reindexInProcess = true;
            reindexService.reindexAllProducts();

        }

        private function onReindexAllProductsFault(event:FaultEvent):void {
            resultText.text = resourceManager.getString("ReindexPanel", "reindexFailedOk") + event.fault;
            reindexBtn.enabled = true;
            resultReady = true;
            reindexInProcess = false;
        }

        private function onReindexAllProductsResult(event:ResultEvent):void {
            reindexBtn.enabled = true;
            resultText.text = resourceManager.getString("ReindexPanel", "reindexResultOk") + event.result;
            resultReady = true;
            reindexInProcess = false;
        }

        ]]>
	</mx:Script>


	<mx:RemoteObject showBusyCursor="true"  id="reindexService"
					 destination="reindexService"
					 channelSet="{ShopManagerGlobal.instance.channelSet}">

        <mx:method id="reindexAllProducts" name="reindexAllProducts"
                   result="onReindexAllProductsResult(event)"
                   fault="onReindexAllProductsFault(event)"/>

    </mx:RemoteObject>

    <mx:Boolean id="resultReady">false</mx:Boolean>
    <mx:Boolean id="reindexInProcess">false</mx:Boolean>


	<mx:VBox height="100%" width="100%">

		<mx:Label text="@Resource(bundle='ReindexPanel',key='reindexProducts')"/>
		<mx:Label text="@Resource(bundle='ReindexPanel',key='reindexMessage')"/>

		<mx:HBox height="64" width="100%">
			<mx:Label text="@Resource(bundle='ReindexPanel',key='startMessage')"/>
			<mx:Button id="reindexBtn" label="@Resource(bundle='ReindexPanel',key='start')" click="onReindexBtnClick(event)"/>
		</mx:HBox>

        <mx:Label id="resultText"
                  includeInLayout="{resultReady}"
                  visible="{resultReady}"/>
        <mx:Label id="reintexingText"
                  text="@Resource(bundle='ReindexPanel',key='reindexInProcess')"
                  includeInLayout="{reindexInProcess}"
                  visible="{reindexInProcess}"/>

	</mx:VBox>

</mx:Canvas>
