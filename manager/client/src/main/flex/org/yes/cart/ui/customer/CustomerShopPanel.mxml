<?xml version="1.0"?>
<!--
  - Copyright 2009 Igor Azarnyi, Denys Pavlov
  -
  -    Licensed under the Apache License, Version 2.0 (the "License");
  -    you may not use this file except in compliance with the License.
  -    You may obtain a copy of the License at
  -
  -        http://www.apache.org/licenses/LICENSE-2.0
  -
  -    Unless required by applicable law or agreed to in writing, software
  -    distributed under the License is distributed on an "AS IS" BASIS,
  -    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  -    See the License for the specific language governing permissions and
  -    limitations under the License.
  -->

<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
           xmlns:controls="controls.*" width="100%" height="100%"
           creationComplete="init();">


    <mx:Script><![CDATA[
        import mx.controls.Alert;
        import mx.rpc.AsyncResponder;
        import mx.rpc.AsyncToken;
        import mx.rpc.events.ResultEvent;

        import org.yes.cart.impl.ShopDTOImpl;

        import org.yes.cart.shopmanager.ShopManagerGlobal;

        public var customerId:Number;

        public function init():void {
            remoteShopService.getAll().addResponder(
                    new AsyncResponder(
                            readCustomerShop,
                            ShopManagerGlobal.instance.defaultOnRpcMethodFault
                    )
            );

        }

        private function readCustomerShop(event:ResultEvent, obj:Object = null):void {

            availableShop = new Array();

            remoteShopService.getAssignedShop(customerId).addResponder(new AsyncResponder(
                    function (event:ResultEvent, obj:Object = null):void {

                        assignedShop = new Array(event.result);
                        for (var shop:Object in remoteShopService.getAll.lastResult) {

                            var found:Boolean = false;

                            for (var registeredShop:Object in assignedShop) {
                                if (registeredShop.name == shop.name) {
                                    found = true;
                                    break;
                                }
                            }
                            if (!found) {
                                availableShop[availableShop.length] = shop;
                            }
                        }
                    }
                    ,
                    ShopManagerGlobal.instance.defaultOnRpcMethodFault
            )
            );


        }


        /**
         * Get shop name for represenatation in list.
         * @param item
         * @return
         */
        private function shopName(item:Object):String {

            try {

                if (item != null) {
                    return item.toString();

                } else {
                    return "" + item;
                }

            }
            catch (error:Error) {
                var e2:String = "none";
                if (item is ShopDTOImpl) {

                    e2 = "yessss";

                }
                var emsg:String = error.toString() + " --- " + item.toString() + "   ++++ " + e2;
                Alert.show( emsg, "eoorrroor");


            }

            return "asdfasdf";


        }
        ]]>
    </mx:Script>


    <mx:Array id="availableShop"></mx:Array>
    <mx:Array id="assignedShop"></mx:Array>


    <mx:RemoteObject showBusyCursor="true" id="remoteShopService"
                     destination="remoteShopService"
                     result="ShopManagerGlobal.instance.defaultOnRpcMethodResult(event)"
                     fault="ShopManagerGlobal.instance.defaultOnRpcMethodFault(event)"
                     channelSet="{ShopManagerGlobal.instance.channelSet}"/>


    <mx:Grid x="0" y="0" width="500" height="100%">
        <mx:GridRow width="100%" height="50">
            <mx:GridItem width="200" height="50" textAlign="center" verticalAlign="middle">
                <mx:Label text="@Resource(bundle='CustomerShopPanel',key='availableShop')"/>
            </mx:GridItem>
            <mx:GridItem width="100%" height="50">
            </mx:GridItem>
            <mx:GridItem width="200" height="50" textAlign="center" verticalAlign="middle">
                <mx:Label text="@Resource(bundle='CustomerShopPanel',key='assignedShop')"/>
            </mx:GridItem>
        </mx:GridRow>
        <mx:GridRow width="100%" height="100%">
            <mx:GridItem width="150" height="100%">
                <mx:List id="availableShopList"
                        width="100%"
                        height="100%"
                        dataProvider="{availableShop}"
                        labelFunction="shopName"
                        >
                </mx:List>
            </mx:GridItem>
            <mx:GridItem width="100%" height="100%" verticalAlign="middle" textAlign="center">
                <mx:VBox width="100%" height="100%" verticalAlign="middle" horizontalAlign="center">
                    <mx:Button width="100"
                               enabled="{false &amp;&amp; availableShopList.selectedItem != null}"
                               label="@Resource(bundle='CustomerShopPanel',key='assign')"
                               toolTip="@Resource(bundle='CustomerShopPanel',key='assignHint')"
                               click="Alert.show('assign')"/>
                    <mx:Button width="100" enabled="{false &amp;&amp; assignedShopList.selectedItem != null}"
                               label="@Resource(bundle='CustomerShopPanel',key='unassign')"
                               toolTip="@Resource(bundle='CustomerShopPanel',key='unassignHint')"
                               click="Alert.show('unassign')"/>
                </mx:VBox>
            </mx:GridItem>
            <mx:GridItem width="150" height="100%">
                <mx:List id="assignedShopList"
                        width="100%"
                        height="100%"
                        dataProvider="{assignedShop}"
                        labelFunction="shopName"
                        >

                </mx:List>
            </mx:GridItem>
        </mx:GridRow>

    </mx:Grid>


</mx:Canvas>
