<?xml version="1.0" encoding="utf-8"?>
<!--
  - Copyright 2009 Igor Azarnyi, Denys Pavlov
  -
  -    Licensed under the Apache License, Version 2.0 (the "License");
  -    you may not use this file except in compliance with the License.
  -    You may obtain a copy of the License at
  -
  -        http://www.apache.org/licenses/LICENSE-2.0
  -
  -    Unless required by applicable law or agreed to in writing, software
  -    distributed under the License is distributed on an "AS IS" BASIS,
  -    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  -    See the License for the specific language governing permissions and
  -    limitations under the License.
  -->

<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
           xmlns:controls="controls.*" xmlns:georg="com.georg.*" width="100%" height="100%">


    <mx:Script>
    <![CDATA[
        import mx.containers.VDividedBox;
        import mx.controls.Alert;
        import mx.events.IndexChangedEvent;
        import mx.rpc.AsyncResponder;
        import mx.rpc.events.ResultEvent;

        import org.yes.cart.shopmanager.ShopManagerGlobal;


        /**
         * Add new tab to edit query and execute it.
         * @param event maouse event
         */
        private function onAddTabClick(event:MouseEvent):void {

            //queryTabNavigator.add
            var divBox:VDividedBox = new VDividedBox();
            divBox.label = "" + queryType.selectedValue;
            divBox.setStyle("width", "100%");
            divBox.setStyle("height", "100%");
            divBox.percentHeight = 100;
            divBox.percentWidth = 100;

            var textArea:TextArea = new TextArea();
            textArea.percentWidth = 100;
            textArea.height = 150;

            var dataGrid:DataGrid = new DataGrid();
            dataGrid.percentWidth = 100;


            divBox.addChild(textArea);

            divBox.addChild(dataGrid);

            queryTabNavigator.addChild(divBox);

        }

        private function onTabClick(event:IndexChangedEvent):void {

        }


        private function onDeleteTabClick(event:MouseEvent):void {
            queryTabNavigator.removeChildAt(queryTabNavigator.selectedIndex);
        }

        private function onExecuteQueryClick(event:MouseEvent):void {

            var sql:String = ((queryTabNavigator.selectedChild as VDividedBox).getChildAt(0) as TextArea).text;

            var dataGrid:DataGrid = ((queryTabNavigator.selectedChild as VDividedBox).getChildAt(1) as DataGrid);

            if ("Sql" == (queryTabNavigator.selectedChild as VDividedBox).label) {

                remoteBackdoorService.sqlQuery(sql).addResponder(

                        new AsyncResponder(
                                function (event:ResultEvent, obj:Object = null):void {

                                    dataGrid.dataProvider = event.result;

                                },
                                ShopManagerGlobal.instance.defaultOnRpcMethodFault)

                );

            } else if ("Hsql" == (queryTabNavigator.selectedChild as VDividedBox).label) {

                remoteBackdoorService.hsqlQuery(sql).addResponder(

                        new AsyncResponder(
                                function (event:ResultEvent, obj:Object = null):void {

                                    dataGrid.dataProvider = event.result;

                                },
                                ShopManagerGlobal.instance.defaultOnRpcMethodFault)

                );

            } else if ("Lucene" == (queryTabNavigator.selectedChild as VDividedBox).label) {

                remoteBackdoorService.luceneQuery(sql).addResponder(

                        new AsyncResponder(
                                function (event:ResultEvent, obj:Object = null):void {

                                    dataGrid.dataProvider = event.result;

                                },
                                ShopManagerGlobal.instance.defaultOnRpcMethodFault)

                );

            }

        }
        ]]>
</mx:Script>

    <mx:RemoteObject showBusyCursor="true" id="remoteBackdoorService"
                     result="ShopManagerGlobal.instance.defaultOnRpcMethodResult(event)"
                     fault="ShopManagerGlobal.instance.defaultOnRpcMethodFault(event)"
                     destination="remoteBackdoorService"
                     channelSet="{ShopManagerGlobal.instance.channelSet}"/>

    <mx:Panel width="100%" height="100%" title="@Resource(bundle='QueryPanel',key='query')">
        <mx:VBox width="100%" height="100%">

            <mx:HBox paddingTop="5" width="100%">

                <mx:RadioButtonGroup id="queryType"/>

                <mx:Label text="@Resource(bundle='QueryPanel',key='queryType')"/>

                <mx:RadioButton group="{queryType}" selected="true" id="Sql"
                                label="@Resource(bundle='QueryPanel',key='sql')"/>
                <mx:RadioButton group="{queryType}" id="Hsql" label="@Resource(bundle='QueryPanel',key='hsql')"/>
                <mx:RadioButton group="{queryType}" id="Lucene" label="@Resource(bundle='QueryPanel',key='lucene')"/>


                <mx:Button id="executeSqlBtn" toolTip="@Resource(bundle='QueryPanel',key='executeHint')"
                           label="@Resource(bundle='QueryPanel',key='execute')" click="onExecuteQueryClick(event)"/>
                <mx:Button id="addTabBtn" toolTip="@Resource(bundle='QueryPanel',key='newTabHint')"
                           label="@Resource(bundle='QueryPanel',key='newTab')" click="onAddTabClick(event)"/>
                <mx:Button id="deleteTabBtn" toolTip="@Resource(bundle='QueryPanel',key='deleteTabHint')"
                           label="@Resource(bundle='QueryPanel',key='deleteTab')" click="onDeleteTabClick(event)"/>

            </mx:HBox>

            <mx:TabNavigator id="queryTabNavigator" width="100%" height="100%">
                <mx:VDividedBox width="100%"
                                height="100%" label="SQL">
                    <mx:TextArea width="100%">

                    </mx:TextArea>
                    <mx:DataGrid width="100%">

                    </mx:DataGrid>

                </mx:VDividedBox>

            </mx:TabNavigator>


        </mx:VBox>
    </mx:Panel>


</mx:Canvas>
